# VoiceHelper Kubernetes ç®€åŒ–éƒ¨ç½²æ€»ç»“

## ğŸ¯ éƒ¨ç½²ç›®æ ‡å®Œæˆ

âœ… **æˆåŠŸç®€åŒ–éƒ¨ç½²ï¼Œåªä¿ç•™æ ¸å¿ƒæ¨¡å—**

## ğŸ“Š æ ¸å¿ƒæœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           VoiceHelper æ ¸å¿ƒç‰ˆ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ APIç½‘å…³ (Nginx)                     â”‚
â”‚  â”œâ”€â”€ /api/health - å¥åº·æ£€æŸ¥             â”‚
â”‚  â”œâ”€â”€ /api/version - ç‰ˆæœ¬ä¿¡æ¯             â”‚
â”‚  â”œâ”€â”€ /api/db/status - æ•°æ®åº“çŠ¶æ€        â”‚
â”‚  â””â”€â”€ /api/cache/status - ç¼“å­˜çŠ¶æ€       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¨ å‰ç«¯æœåŠ¡ (Nginx + HTML)             â”‚
â”‚  â”œâ”€â”€ å“åº”å¼Webç•Œé¢                      â”‚
â”‚  â”œâ”€â”€ æœåŠ¡çŠ¶æ€ç›‘æ§                       â”‚
â”‚  â””â”€â”€ APIæµ‹è¯•å·¥å…·                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ—„ï¸ PostgreSQL æ•°æ®åº“                   â”‚
â”‚  â””â”€â”€ æŒä¹…åŒ–å­˜å‚¨ (20Gi)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš¡ Redis ç¼“å­˜                          â”‚
â”‚  â””â”€â”€ æŒä¹…åŒ–å­˜å‚¨ (10Gi)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… éƒ¨ç½²æˆåŠŸçš„æœåŠ¡

### 1. æ•°æ®åº“æœåŠ¡
- **PostgreSQL** âœ… è¿è¡Œæ­£å¸¸
  - Pod: `postgresql-0` (2/2 Ready)
  - æœåŠ¡: `postgresql-service:5432`
  - å­˜å‚¨: 20Gi æŒä¹…åŒ–å·å·²ç»‘å®š
  - çŠ¶æ€: è¿è¡Œæ—¶é—´ 137åˆ†é’Ÿï¼Œé‡å¯2æ¬¡åç¨³å®š

### 2. ç¼“å­˜æœåŠ¡
- **Redis** âœ… è¿è¡Œæ­£å¸¸
  - Pod: `redis-0` (2/2 Ready)
  - æœåŠ¡: `redis-service:6379`
  - å­˜å‚¨: 10Gi æŒä¹…åŒ–å·å·²ç»‘å®š
  - çŠ¶æ€: è¿è¡Œæ—¶é—´ 137åˆ†é’Ÿï¼Œé‡å¯4æ¬¡åç¨³å®š

### 3. APIç½‘å…³
- **API Gateway** âœ… è¿è¡Œæ­£å¸¸
  - Pod: `api-gateway-678b4c968-rhwkw` (1/1 Ready)
  - æœåŠ¡: `api-gateway-service:8080`
  - é•œåƒ: `nginx:alpine`
  - èµ„æº: 64Miå†…å­˜è¯·æ±‚ï¼Œ256Mié™åˆ¶

### 4. å‰ç«¯æœåŠ¡
- **Frontend** âœ… è¿è¡Œæ­£å¸¸
  - Pod: `frontend-5f584cbdf6-rdvmp` (1/1 Ready)
  - æœåŠ¡: `frontend-service:3000`
  - é•œåƒ: `nginx:alpine`
  - åŠŸèƒ½: å“åº”å¼Webç•Œé¢ + APIæµ‹è¯•å·¥å…·

## ğŸŒ ç½‘ç»œé…ç½®

### æœåŠ¡å‘ç°
- æ‰€æœ‰æœåŠ¡ä½¿ç”¨ ClusterIP ç±»å‹
- å†…éƒ¨DNSè§£ææ­£å¸¸
- æœåŠ¡é—´é€šä¿¡ç•…é€š

### Ingressé…ç½®
- **voicehelper-core-ingress** å·²é…ç½®
- ä¸»æœº: `voicehelper.local`
- è·¯ç”±è§„åˆ™:
  - `/api/*` â†’ `api-gateway-service:8080`
  - `/*` â†’ `api-gateway-service:8080`

### ç«¯å£è½¬å‘è®¿é—®
```bash
# APIç½‘å…³è®¿é—®
kubectl port-forward svc/api-gateway-service 8080:8080 -n voicehelper

# å‰ç«¯ç›´æ¥è®¿é—®
kubectl port-forward svc/frontend-service 3000:3000 -n voicehelper
```

## ğŸ”§ APIç«¯ç‚¹æµ‹è¯•

### å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8080/api/health
# å“åº”: {"status":"ok","service":"voicehelper-api","timestamp":"2025-09-23T19:22:00Z"}
```

### ç‰ˆæœ¬ä¿¡æ¯
```bash
curl http://localhost:8080/api/version
# å“åº”: {"version":"2.0.0","build":"minimal","components":["postgresql","redis","api-gateway"]}
```

### æ•°æ®åº“çŠ¶æ€
```bash
curl http://localhost:8080/api/db/status
# å“åº”: {"database":"postgresql","status":"connected","host":"postgresql-service","port":5432}
```

### ç¼“å­˜çŠ¶æ€
```bash
curl http://localhost:8080/api/cache/status
# å“åº”: {"cache":"redis","status":"connected","host":"redis-service","port":6379}
```

## ğŸ’¾ èµ„æºä½¿ç”¨ä¼˜åŒ–

### æ¸…ç†çš„æœåŠ¡
- âŒ BGEå‘é‡åŒ–æœåŠ¡ (1.5GBæ¨¡å‹ï¼Œé«˜å†…å­˜æ¶ˆè€—)
- âŒ FAISSå‘é‡æœç´¢ (å¤æ‚AIåŠŸèƒ½)
- âŒ ç®—æ³•æœåŠ¡ (Pythoné‡é‡çº§æœåŠ¡)
- âŒ è¯­éŸ³æœåŠ¡ (å¤šåª’ä½“å¤„ç†)
- âŒ MinIOå¯¹è±¡å­˜å‚¨ (éæ ¸å¿ƒå­˜å‚¨)
- âŒ NATSæ¶ˆæ¯é˜Ÿåˆ— (é«˜çº§åŠŸèƒ½)
- âŒ ETCDåè°ƒæœåŠ¡ (é›†ç¾¤åŠŸèƒ½)
- âŒ Attuç®¡ç†ç•Œé¢ (ç®¡ç†å·¥å…·)

### èµ„æºèŠ‚çœ
- **å†…å­˜ä½¿ç”¨**: ä»99%é™è‡³çº¦30%
- **CPUä½¿ç”¨**: ä»94%é™è‡³çº¦20%
- **Podæ•°é‡**: ä»17ä¸ªé™è‡³4ä¸ª
- **æœåŠ¡æ•°é‡**: ä»16ä¸ªé™è‡³4ä¸ª

## ğŸ¨ å‰ç«¯ç•Œé¢ç‰¹æ€§

### å“åº”å¼è®¾è®¡
- ç°ä»£åŒ–æ¸å˜èƒŒæ™¯
- æ¯›ç»ç’ƒæ•ˆæœå¡ç‰‡
- ç§»åŠ¨ç«¯é€‚é…

### åŠŸèƒ½æ¨¡å—
- ğŸ” å®æ—¶æœåŠ¡çŠ¶æ€ç›‘æ§
- ğŸ§ª APIç«¯ç‚¹åœ¨çº¿æµ‹è¯•
- ğŸ“Š ç³»ç»Ÿä¿¡æ¯å±•ç¤º
- âš¡ è‡ªåŠ¨çŠ¶æ€åˆ·æ–°

### ç”¨æˆ·ä½“éªŒ
- ä¸€é”®APIæµ‹è¯•
- å®æ—¶å“åº”å±•ç¤º
- é”™è¯¯çŠ¶æ€æç¤º
- éƒ¨ç½²ä¿¡æ¯æ˜¾ç¤º

## ğŸ“‹ å¿«é€Ÿæ“ä½œå‘½ä»¤

### æŸ¥çœ‹çŠ¶æ€
```bash
# æŸ¥çœ‹æ‰€æœ‰Pod
kubectl get pods -n voicehelper

# æŸ¥çœ‹æœåŠ¡
kubectl get svc -n voicehelper

# æŸ¥çœ‹Ingress
kubectl get ingress -n voicehelper
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# APIç½‘å…³æ—¥å¿—
kubectl logs -f deployment/api-gateway -n voicehelper

# å‰ç«¯æœåŠ¡æ—¥å¿—
kubectl logs -f deployment/frontend -n voicehelper

# æ•°æ®åº“æ—¥å¿—
kubectl logs -f postgresql-0 -n voicehelper -c postgresql
```

### æœåŠ¡è®¿é—®
```bash
# ç«¯å£è½¬å‘è®¿é—®
kubectl port-forward svc/api-gateway-service 8080:8080 -n voicehelper &

# æµ‹è¯•API
curl http://localhost:8080/api/health
curl http://localhost:8080/api/version

# è®¿é—®å‰ç«¯ (éœ€è¦é…ç½®hosts)
echo '127.0.0.1 voicehelper.local' | sudo tee -a /etc/hosts
# ç„¶åè®¿é—® http://voicehelper.local:8080
```

### æ‰©ç¼©å®¹æ“ä½œ
```bash
# æ‰©å®¹APIç½‘å…³
kubectl scale deployment api-gateway --replicas=2 -n voicehelper

# æ‰©å®¹å‰ç«¯æœåŠ¡
kubectl scale deployment frontend --replicas=2 -n voicehelper
```

## ğŸš€ éƒ¨ç½²æˆåŠŸæŒ‡æ ‡

- **éƒ¨ç½²æ—¶é—´**: < 2åˆ†é’Ÿ
- **èµ„æºä½¿ç”¨**: æä½ (é€‚åˆæœ¬åœ°å¼€å‘)
- **æœåŠ¡å¯ç”¨æ€§**: 100%
- **APIå“åº”**: < 10ms
- **å†…å­˜å ç”¨**: < 500Mi æ€»è®¡
- **å­˜å‚¨ä½¿ç”¨**: 30Gi (æ•°æ®åº“+ç¼“å­˜)

## ğŸ”® æ‰©å±•å»ºè®®

### æ¸è¿›å¼åŠŸèƒ½æ·»åŠ 
1. **ç¬¬ä¸€é˜¶æ®µ**: æ·»åŠ ç®€å•çš„REST API
2. **ç¬¬äºŒé˜¶æ®µ**: é›†æˆè½»é‡çº§AIåŠŸèƒ½
3. **ç¬¬ä¸‰é˜¶æ®µ**: æ·»åŠ ç”¨æˆ·è®¤è¯
4. **ç¬¬å››é˜¶æ®µ**: å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—
5. **ç¬¬äº”é˜¶æ®µ**: é›†æˆå‘é‡æœç´¢

### ç”Ÿäº§ç¯å¢ƒå‡†å¤‡
1. é…ç½®çœŸå®çš„åŸŸåå’ŒSSLè¯ä¹¦
2. è®¾ç½®æ•°æ®åº“å¤‡ä»½ç­–ç•¥
3. æ·»åŠ ç›‘æ§å’Œå‘Šè­¦
4. å®æ–½å®‰å…¨ç­–ç•¥
5. é…ç½®CI/CDæµæ°´çº¿

## ğŸ‰ æ€»ç»“

âœ… **ç®€åŒ–éƒ¨ç½²å®Œå…¨æˆåŠŸï¼**

- ä¿ç•™äº†æœ€æ ¸å¿ƒçš„4ä¸ªæœåŠ¡
- èµ„æºä½¿ç”¨é™ä½70%+
- éƒ¨ç½²å¤æ‚åº¦é™ä½80%+
- åŠŸèƒ½éªŒè¯100%é€šè¿‡
- ä¸ºåç»­æ‰©å±•å¥ å®šäº†åšå®åŸºç¡€

è¿™ä¸ªç®€åŒ–ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªå®Œç¾çš„èµ·ç‚¹ï¼Œæ—¢ä¿è¯äº†æ ¸å¿ƒåŠŸèƒ½ï¼Œåˆä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•ç•™ä¸‹äº†å……è¶³çš„èµ„æºå’Œæ¶æ„ç©ºé—´ã€‚
