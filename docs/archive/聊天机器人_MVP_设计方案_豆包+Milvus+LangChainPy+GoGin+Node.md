# ä¸€ã€æ¦‚è§ˆ
- **æ¨¡å‹**ï¼šè±†åŒ…å¤§æ¨¡å‹ï¼ˆç«å±±æ–¹èˆŸ Arkï¼ŒOpenAI-Compatible æ¥å£ï¼‰
- **å‘é‡æ•°æ®åº“**ï¼šMilvusï¼ˆæ”¯æŒ HNSW / IVF_FLAT / HNSW_PQ ç­‰ç´¢å¼•ï¼‰
- **ç®—æ³•/ç¼–æ’**ï¼šPythonï¼ŒåŸºäº LangChainï¼ˆ`langchain`, `langchain-milvus`ï¼‰
- **åç«¯**ï¼šGoï¼ŒGin æ¡†æ¶ï¼ˆREST + SSE / WSï¼‰ï¼Œè´Ÿè´£é‰´æƒã€è·¯ç”±ã€é™æµã€è§‚æµ‹ä¸ç¼–æ’è°ƒåº¦åˆ°ç®—æ³•æœåŠ¡
- **å‰ç«¯**ï¼šNode.jsï¼ˆNext.js/SSR + Edge Runtime å¯é€‰ï¼‰ï¼Œå†…åµŒ Chat UI ä¸ç®€ç‰ˆç®¡ç†åå°
- **éƒ¨ç½²**ï¼šKubernetesï¼ˆæˆ– Docker Compose èµ·æ­¥ï¼‰ï¼Œåˆ†ç¯å¢ƒï¼ˆdev/staging/prodï¼‰ï¼Œä»¥ API Key + OIDC ç»Ÿä¸€é‰´æƒ
- **MVP èƒ½åŠ›**ï¼šå¯¹è¯ã€RAGï¼ˆä¸Šä¼ â†’è§£æâ†’åˆ‡ç‰‡â†’å‘é‡åŒ–â†’æ£€ç´¢â†’ç”Ÿæˆï¼‰ã€ä¼šè¯è®°å¿†ï¼ˆçŸ­æœŸï¼‰ã€æµå¼è¾“å‡ºã€åŸºç¡€è¿è¥ç»Ÿè®¡ä¸æˆæœ¬å¯è§‚æµ‹

---

# äºŒã€æ€»ä½“æ¶æ„
```
[Browser/SDK]
  â””â”€ Next.js Chat UI (SSE/WS, ä¸Šä¼ /æ£€ç´¢, ç™»å½•)
       â””â”€ BFF(å¯é€‰)+API è°ƒç”¨ â†’ Go/Gin Backend (Auth/Rate Limit/Orchestration)
            â”œâ”€ Python Algo Serviceï¼ˆLangChain Pipelineï¼ŒHTTP/gRPCï¼‰
            â”‚    â”œâ”€ Ingestï¼šè§£æâ†’åˆ‡ç‰‡â†’Embeddingâ†’Milvus
            â”‚    â”œâ”€ Queryï¼šæ£€ç´¢â†’é‡æ’(å¯é€‰)â†’æç¤ºç»„è£…â†’LLM(è±†åŒ…)
            â”‚    â””â”€ Memoryï¼šçŸ­æœŸä¼šè¯ã€æŸ¥è¯¢ç¼“å­˜
            â”œâ”€ Milvusï¼ˆå‘é‡ç›¸ä¼¼æ£€ç´¢ï¼‰
            â”œâ”€ è±†åŒ… LLMï¼ˆArk ChatCompletionsï¼‰
            â”œâ”€ Redis / Postgresï¼ˆä¼šè¯ã€ç”¨æˆ·ã€KV ç¼“å­˜ï¼‰
            â””â”€ Obsï¼šOTel/Prometheus/Grafana + æ—¥å¿—ï¼ˆELK/Vectorï¼‰
```

---

# ä¸‰ã€æ¨¡å—åˆ’åˆ†

## 3.1 å‰ç«¯ï¼ˆNode.js / Next.jsï¼‰
**èŒè´£**ï¼šä¼šè¯ä¸æ¶ˆæ¯ UIã€ä¸Šä¼ å…¥å£ã€å¼•ç”¨ç‰‡æ®µå±•ç¤ºã€åé¦ˆæ”¶é›†ã€ç™»å½•é‰´æƒã€åŸºç¡€ç»Ÿè®¡é¢æ¿

**å…³é”®ç‚¹**ï¼š
- **é¡µé¢**ï¼š
  - `/chat`ï¼šä¸»å¯¹è¯ç•Œé¢ï¼ˆæ¶ˆæ¯æµã€å¼•ç”¨æŠ˜å /å±•å¼€ã€å¤åˆ¶ã€åé¦ˆğŸ‘/ğŸ‘ï¼‰
  - `/datasets`ï¼šæ•°æ®æº/æ–‡æ¡£åˆ—è¡¨ä¸ç´¢å¼•çŠ¶æ€ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
  - `/analytics`ï¼šä¼šè¯æ•°ã€å¹³å‡å“åº”æ—¶é•¿ã€Token/æˆæœ¬ï¼ˆç®€ç‰ˆï¼‰
- **äº¤äº’**ï¼šSSE ä¼˜å…ˆï¼ˆé™çº§ WSï¼‰ï¼Œæ‰“å­—æœºæµå¼æ¸²æŸ“ï¼›æ–‡ä»¶/URL ä¸Šä¼ ï¼ˆå¤šæ–‡ä»¶é˜Ÿåˆ—ï¼‰
- **é‰´æƒ**ï¼šOIDC/ä¼ä¸š SSOï¼Œå¯é€‰ JWT Cookieï¼›å‰ç«¯è·¯ç”±å®ˆå« + SSR è¾¹ç¼˜ç¼“å­˜ï¼ˆç”¨æˆ·/ç§Ÿæˆ·éš”ç¦»ï¼‰
- **å¯ç”¨æ€§**ï¼šå¤±è´¥é‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼‰ã€æ–­çº¿è‡ªåŠ¨æ¢å¤ã€è¾“å…¥èŠ‚æµï¼ˆé˜²æŠ– 300msï¼‰
- **å¯è§‚æµ‹**ï¼šWeb Vitalsã€å‰ç«¯åŸ‹ç‚¹ï¼ˆä¼šè¯å¼€å§‹/ç»“æŸã€åé¦ˆã€é”™è¯¯ç ã€è€—æ—¶ï¼‰

**ä¸åç«¯æ¥å£ï¼ˆç¤ºä¾‹ï¼‰**ï¼š
- `POST /api/chat/stream`ï¼ˆSSEï¼‰ï¼š{conversation_id?, messages[], tools?}
- `POST /api/ingest/upload`ï¼šmultipart æ–‡ä»¶ä¸Šä¼ ï¼Œè¿”å› task_id
- `GET  /api/ingest/tasks/:id`ï¼šæŸ¥çœ‹è§£æ/åˆ‡ç‰‡/å…¥åº“è¿›åº¦
- `GET  /api/search?q=...`ï¼šä»…æ£€ç´¢é¢„è§ˆï¼ˆå¼€å‘/éªŒæ”¶ç”¨ï¼‰

---

## 3.2 åç«¯ï¼ˆGo / Ginï¼‰
**èŒè´£**ï¼šç»Ÿä¸€ API ç½‘å…³ï¼ˆAuthã€é…é¢ã€é™æµã€å®¡è®¡ï¼‰ã€å¯¹è¯ç¼–æ’å…¥å£ã€ä¸ç®—æ³•æœåŠ¡/è±†åŒ…/Milvus çš„ç²˜åˆã€SSE/WS æµå¼æ¨é€ã€è¿ç»´ä¸å¯è§‚æµ‹

**å­æ¨¡å—**ï¼š
- **Auth & ç§Ÿæˆ·**ï¼šOIDC ç™»å½•ã€API Keyã€ç§Ÿæˆ·éš”ç¦»ï¼ˆHeader `X-Tenant-ID` + DB Scopeï¼‰
- **é™æµ/ç†”æ–­/é‡è¯•**ï¼šåŸºäºä»¤ç‰Œæ¡¶ï¼ˆIP/ç”¨æˆ·/ç§Ÿæˆ·/è·¯å¾„ç²’åº¦ï¼‰ã€ä¸‹æ¸¸è¶…æ—¶ä¸é‡è¯•ç­–ç•¥ï¼ˆå¹‚ç­‰è·¯å¾„ï¼‰
- **SSE/WS ç½‘å…³**ï¼šå°† Python ç®—æ³•æœåŠ¡çš„ Token Stream è½¬å‘åˆ°å®¢æˆ·ç«¯ï¼›å¿ƒè·³ä¸æ–­ç‚¹ç»­ä¼ 
- **ç¼–æ’å±‚**ï¼š
  - Chatï¼šæ¥æ”¶ messages â†’ è°ƒç”¨ Algo `/query` â†’ æŒ‰ token æµå¼å›ä¼ 
  - Ingestï¼šä¸Šä¼ è½¬å­˜å¯¹è±¡å­˜å‚¨ï¼ˆæœ¬åœ°/OSS/S3ï¼‰ï¼Œä¸‹å‘è§£æä»»åŠ¡åˆ° Algo `/ingest`
  - Adminï¼šæ•°æ®é›†ã€ç´¢å¼•çŠ¶æ€ã€å¥åº·æ£€æŸ¥
- **è§‚æµ‹**ï¼š
  - Tracingï¼šW3C TraceContext â†’ è´¯ç©¿å‰ç«¯ã€Goã€Pythonã€Milvusã€Ark
  - Metricsï¼šP50/P95ã€QPSã€é”™è¯¯ç‡ã€å¤–å‘¼è€—æ—¶åˆ†è§£ï¼ˆæ£€ç´¢ã€ç”Ÿæˆï¼‰
  - Loggingï¼šç»“æ„åŒ– JSONï¼Œå…³è” TraceID/SpanID

**Gin è·¯ç”±ï¼ˆç¤ºä¾‹ï¼‰**ï¼š
```
POST /api/chat/stream         // SSE è¿”å›
POST /api/ingest/upload
POST /api/ingest/url
GET  /api/ingest/tasks/:id
GET  /api/datasets            // åˆ—è¡¨/çŠ¶æ€
GET  /api/healthz
```

**ä¸ç®—æ³•æœåŠ¡é€šä¿¡**ï¼š
- åè®®ï¼šHTTP/JSONï¼ˆMVPï¼‰ï¼Œå¯æ¼”è¿›åˆ° gRPC
- è¶…æ—¶ï¼šQuery 30sã€Ingest 300sï¼›æ”¯æŒ `X-Request-ID`ã€`X-Tenant-ID`

---

## 3.3 ç®—æ³•ï¼ˆPython / LangChainï¼‰
**èŒè´£**ï¼šRAG å…¨æµç¨‹ä¸ LLM è°ƒç”¨ï¼Œæš´éœ²è½»é‡ APIï¼Œè¢« Go åç«¯ç¼–æ’

**å…³é”®ä¾èµ–**ï¼š`langchain`, `langchain-community`, `langchain-text-splitters`, `langchain-milvus`, `pymilvus`, `fastapi`/`litestar`, `uvicorn`, `tiktoken`ï¼ˆæˆ– `dashscope-tokenizer` æ›¿ä»£ï¼‰ã€`pydantic`

**æœåŠ¡æ¥å£**ï¼š
- `POST /ingest`ï¼š
  - å…¥å‚ï¼š{dataset_id, files[]|urls[], metadata, chunk_size, chunk_overlap, embedding_model}
  - æµç¨‹ï¼š
    1) è§£æå™¨ï¼ˆPDF/Doc/HTML/Markdown/çº¯æ–‡æœ¬ï¼‰
    2) æ¸…æ´—ï¼ˆå»æ ·å¼ã€å»è„šæ³¨/ç›®å½•ã€æ­£æ–‡æŠ½å–ï¼‰
    3) åˆ‡ç‰‡ï¼ˆ`RecursiveCharacterTextSplitter` çº¦ 500~800 tokensï¼Œoverlap 50~120ï¼‰
    4) å‘é‡åŒ–ï¼ˆé»˜è®¤ï¼šè±†åŒ… Embedding *è‹¥æœªå¼€é€šåˆ™å›é€€ bge-m3/bge-large-zh*ï¼‰
    5) å†™å…¥ Milvusï¼šcollection schemaï¼ˆ`id`, `text`, `vector`, `source`, `chunk_id`, `doc_id`, `tenant_id`, `tags`, `updated_at`ï¼‰
    6) å»ºç´¢å¼•/åŠ è½½ï¼ˆHNSW / IVF_FLAT / HNSW_PQï¼Œé˜ˆå€¼ï¼š`score>=0.3` å¯é…ç½®ï¼‰
- `POST /query`ï¼š
  - å…¥å‚ï¼š{messages[], top_k=5, rerank=false|"bge-reranker", filters{tags,doc_id}, temperature, max_tokens}
  - æµç¨‹ï¼š
    1) ä» messages æå–æœ€æ–° user query
    2) æ£€ç´¢ï¼ˆMilvus â†’ `similarity_search_with_score`ï¼‰ï¼Œå¯é€‰å¤šè·¯å¬å› + MMR
    3) ï¼ˆå¯é€‰ï¼‰è½»é‡é‡æ’ï¼ˆcross-encoderï¼‰
    4) Prompt ç»„è£…ï¼ˆç³»ç»ŸæŒ‡ä»¤ + å†å²æ‘˜è¦ + æ£€ç´¢ç‰‡æ®µ + å¼•ç”¨æ ¼å¼ï¼‰
    5) è°ƒç”¨è±†åŒ… ChatCompletionsï¼ˆæµå¼ï¼‰
    6) è¿”å›ï¼šdelta tokens + å¼•ç”¨å…ƒæ•°æ®ï¼ˆchunk_idã€sourceã€scoreï¼‰
- `POST /summarize`ï¼ˆå¯é€‰ï¼‰ï¼šé•¿æ–‡æ‘˜è¦ã€å¯¹è¯è®°å¿†å‹ç¼©

**å‘é‡ä¸ç´¢å¼•**ï¼š
- ç»´åº¦ï¼šä¸æ‰€é€‰ embedding æ¨¡å‹ä¸€è‡´ï¼ˆä¾‹å¦‚ bge-m3=1024ï¼‰
- Metricï¼šcosine ä¼˜å…ˆï¼ˆæ–‡æœ¬ç›¸ä¼¼ï¼‰ï¼ŒMilvus `IP` æˆ– `COSINE`
- ç´¢å¼•å»ºè®®ï¼ˆMVPï¼‰ï¼šæ•°æ®é‡ < 100 ä¸‡ â†’ **HNSW**ï¼›> 100 ä¸‡æˆ–æˆæœ¬æ•æ„Ÿ â†’ **IVF_FLAT / HNSW_PQ**

**Prompt åŸºçº¿ï¼ˆç‰‡æ®µå‹é—®ç­”ï¼‰**ï¼š
```
ç³»ç»Ÿï¼šä½ æ˜¯ä¼ä¸šçŸ¥è¯†åŠ©æ‰‹ï¼ŒåªåŸºäºæ£€ç´¢åˆ°çš„ç‰‡æ®µå›ç­”ï¼›æ— æ³•ä»ç‰‡æ®µä¸­æ‰¾åˆ°ä¾æ®æ—¶ï¼Œæ˜ç¡®å‘ŠçŸ¥â€œæ²¡æœ‰æ‰¾åˆ°ä¾æ®â€ï¼Œå¹¶æå‡ºå¯è¡Œçš„ä¸‹ä¸€æ­¥ã€‚
ç”¨æˆ·é—®é¢˜ï¼š{query}
å¯ç”¨ç‰‡æ®µï¼ˆå¸¦ç¼–å·ä¸æ¥æºï¼‰ï¼š
{context}
å›ç­”è¦æ±‚ï¼š
- ä¸­æ–‡ï¼›ç»™å‡ºå¼•ç”¨ç¼–å·ï¼Œä¾‹å¦‚[1][3]
- å…ˆç»“è®ºå†ä¾æ®ï¼Œç®€æ´åˆ†ç‚¹
- å¦‚éœ€æ­¥éª¤ï¼Œä½¿ç”¨ 1/2/3 ç¼–å·
```

---

# å››ã€æ•°æ®ä¸å­˜å‚¨
- **Milvus**ï¼š
  - Collection æŒ‰ç§Ÿæˆ·/æ•°æ®é›†åˆ†è¡¨æˆ–åŒè¡¨åŠ  `tenant_id`/`dataset_id` å­—æ®µ
  - åˆ†åŒºï¼šæŒ‰ `doc_id`/æ—¥æœŸæˆ– `tags`ï¼Œä¾¿äºå†·çƒ­ä¸ ACL
  - ç´¢å¼•ï¼šä¼˜å…ˆ HNSWï¼ˆ`M=16, efConstruction=200`ï¼‰ï¼ŒæŸ¥è¯¢ `efSearch` åŠ¨æ€è°ƒå‚ï¼›æˆ– IVF_FLATï¼ˆ`nlist`â‰ˆâˆšNï¼‰
- **å¯¹è±¡å­˜å‚¨**ï¼šåŸå§‹æ–‡ä»¶ä¸è§£æä¸­é—´ä»¶ï¼ˆS3/OSS/æœ¬åœ°ç£ç›˜ï¼‰
- **å…³ç³»å‹**ï¼šPostgresï¼ˆç”¨æˆ·ã€ä¼šè¯ã€é…é¢ã€è®¡è´¹/é…ç½®ä¿¡æ¯ï¼‰
- **ç¼“å­˜**ï¼šRedisï¼ˆä¼šè¯çŸ­æœŸè®°å¿†ã€çƒ­é—®é¢˜ç¼“å­˜ã€embedding ç»“æœç¼“å­˜ï¼‰

---

# äº”ã€API å¥‘çº¦ï¼ˆMVP è‰æ¡ˆï¼‰
## 5.1 å¯¹è¯æµï¼ˆSSEï¼‰
```
POST /api/chat/stream
Headers: Authorization: Bearer <token>
Body: {
  "conversation_id": "c_123"?,
  "messages": [
    {"role":"system","content":"..."}?,
    {"role":"user","content":"..."}
  ],
  "tools": [{"type":"search","args":{...}}]?,
  "top_k": 5,
  "temperature": 0.3
}
// SSE äº‹ä»¶ï¼šdata: {"type":"delta","content":"...","refs":[{chunk_id,source,score}]}
```

## 5.2 æ–‡æ¡£å…¥åº“
```
POST /api/ingest/upload  // Gin æ¥æ”¶ï¼Œè½¬å‘åˆ° /ingest
POST /algo/ingest        // Python FastAPI
```

## 5.3 æ£€ç´¢é¢„è§ˆ
```
GET /api/search?q=...&top_k=5&filters=...
```

---

# å…­ã€éƒ¨ç½²ä¸è¿ç»´
- **é•œåƒ**ï¼š
  - `backend-gin`: å¤šé˜¶æ®µæ„å»ºï¼Œå¯ç”¨ `GOMAXPROCS`, `GIN_MODE=release`
  - `algo-langchain`: `uvicorn --workers=2 --http h11 --loop uvloop`
- **K8s å»ºè®®**ï¼š
  - æ¯ä¸ªæœåŠ¡ `HPA`ï¼ˆCPU 60%/è‡ªå®šä¹‰ QPS æŒ‡æ ‡ï¼‰ï¼Œ`PodDisruptionBudget`
  - **Milvus**ï¼šç‹¬ç«‹é›†ç¾¤/äº‘æ‰˜ç®¡ï¼›SSD ä¼˜å…ˆï¼›è§‚æµ‹ Milvus `search_latency`ã€`nq`, `ef`
  - **å¯†é’¥**ï¼šArk API Keyã€DBã€OIDC å¯†é’¥æ”¾å…¥ `Secret`ï¼›ä½¿ç”¨ `ExternalSecret`/KMS
- **å¯è§‚æµ‹**ï¼š
  - Tracingï¼šå‰åç«¯å…¨é“¾è·¯ï¼ˆå‰ç«¯ header â†’ Gin â†’ Algo â†’ Milvus/Arkï¼‰
  - Metricsï¼š
    - ç«¯åˆ°ç«¯ P95 < 800msï¼ˆçº¯å¯¹è¯ï¼Œä¸å«é•¿æ£€ç´¢ï¼‰
    - RAG å›ç­”é¦– token < 1.2sï¼ˆSSEï¼‰
    - æ£€ç´¢å¬å›ç‡@5 â‰¥ 0.85ï¼ˆç¦»çº¿è¯„æµ‹é›†ï¼‰

---

# ä¸ƒã€å®‰å…¨ä¸åˆè§„ï¼ˆMVP å¿…åšï¼‰
- ç§Ÿæˆ·éš”ç¦»ï¼ˆé€»è¾‘çº§ ACL + è¡Œçº§è¿‡æ»¤ï¼‰ï¼Œç¦æ­¢è·¨ç§Ÿæˆ·æ£€ç´¢
- æ•æ„Ÿè¯/PII æ¢æµ‹ï¼ˆä¸Šä¼ ä¸å›ç­”å‰ç½®è§„åˆ™ï¼Œè¿è§„æ‰“ç /é˜»æ–­ï¼‰
- å®¡è®¡æ—¥å¿—ï¼ˆæŸ¥è¯¢ã€ä¸Šä¼ ã€åˆ é™¤ã€ç®¡ç†æ“ä½œï¼‰
- é€Ÿç‡é™åˆ¶ä¸æ¶ˆè´¹ä¸Šé™ï¼ˆæŒ‰ç”¨æˆ·/ç§Ÿæˆ·/å¤©ï¼‰

---

# å…«ã€æ¼”è¿›è·¯çº¿
1) **Rerank å¼•å…¥**ï¼šbge-reranker-baseï¼ˆå¯é€‰ï¼‰
2) **è¯­ä¹‰ç¼“å­˜**ï¼šquery/embedding ç¼“å­˜ + è¿‘ä¼¼åŒ¹é…é˜ˆå€¼
3) **å·¥å…·è°ƒç”¨**ï¼šFAQ/SQL/å†…ç½‘ APIï¼ˆå¢åŠ  Tool Router ä¸å‚æ•°æå–ï¼‰
4) **å¤šæ¨¡æ€**ï¼šå›¾ç‰‡/æˆªå›¾è§£æï¼ˆæ–‡æ¡£ OCRï¼‰ï¼Œå›¾ç‰‡å‘é‡å…¥åº“
5) **æ²»ç†**ï¼šPrompt ç‰ˆæœ¬ç®¡ç†ã€è¯„æµ‹æ•°æ®é›†ä¸ç¦»çº¿æŒ‡æ ‡é¢æ¿

---

# ä¹ã€ç›®å½•ç»“æ„ï¼ˆç¤ºä¾‹ï¼‰
```
repo/
  frontend/            # Next.js
  backend/             # Go/Gin
    cmd/server
    internal/handler
    internal/service
    pkg/middleware
  algo/                # Python/LangChain/FastAPI
    app/api.py
    core/ingest.py
    core/retrieve.py
    core/prompt.py
  deploy/
    k8s/
    compose/
```

---

# åã€MVP å¼€å‘æ¸…å•ï¼ˆTODOï¼‰
**å‰ç«¯**
- [ ] Chat UIï¼ˆSSEï¼‰ä¸æ¶ˆæ¯åˆ—è¡¨ï¼ˆå¸¦å¤åˆ¶ã€ä»£ç é«˜äº®ï¼‰
- [ ] å¼•ç”¨ç‰‡æ®µ UIï¼ˆç¼–å·/æ¥æº/æ‰“å¼€å±•ç¤ºï¼‰
- [ ] æ–‡ä»¶ä¸Šä¼ ï¼ˆæ‹–æ‹½/å¤šæ–‡ä»¶é˜Ÿåˆ—/è¿›åº¦æ¡ï¼‰
- [ ] ç™»å½•ï¼ˆOIDC/JWTï¼‰ä¸åŸºç¡€è§’è‰²ï¼ˆadmin/userï¼‰
- [ ] ç®¡ç†é¡µï¼šæ•°æ®é›†åˆ—è¡¨ã€ä»»åŠ¡çŠ¶æ€ã€ç®€ç‰ˆç»Ÿè®¡

**åç«¯ï¼ˆGo/Ginï¼‰**
- [ ] è·¯ç”±ä¸ä¸­é—´ä»¶ï¼ˆæ—¥å¿—ã€æ¢å¤ã€é™æµã€CORSã€é‰´æƒï¼‰
- [ ] `/api/chat/stream` SSE è½¬å‘ä¸æ–­ç‚¹ç»­ä¼ 
- [ ] `/api/ingest/upload` å¯¹è±¡å­˜å‚¨ä¸­è½¬ + è°ƒç”¨ç®—æ³• `/ingest`
- [ ] å¤šç§Ÿæˆ·ä¸é…é¢ï¼ˆHeader + DB Scopeï¼‰
- [ ] OTel + Prometheus æŒ‡æ ‡ä¸åˆ†å¸ƒå¼è¿½è¸ª

**ç®—æ³•ï¼ˆPython/LangChainï¼‰**
- [ ] FastAPI æœåŠ¡éª¨æ¶ï¼ˆ/ingest, /queryï¼‰
- [ ] æ–‡æ¡£è§£æå™¨ä¸åˆ‡ç‰‡ç­–ç•¥ï¼ˆå¯é…ç½® chunkï¼‰
- [ ] Milvus é›†æˆï¼ˆ`langchain-milvus`ï¼Œå»ºè¡¨/å»ºç´¢å¼•/åŠ è½½ï¼‰
- [ ] Embedding é€‚é…ï¼ˆä¼˜å…ˆè±†åŒ…ï¼Œå›é€€ bge-*ï¼‰
- [ ] RAG Pipelineï¼ˆå¬å›â†’å¯é€‰ MMRâ†’Promptâ†’è±†åŒ…æµå¼ï¼‰
- [ ] ç®€å•è¯„æµ‹è„šæœ¬ï¼ˆå¬å›ç‡ã€ç­”æ¡ˆ BLEU/ROUGEã€äººå·¥æ ‡æ³¨é‡‡æ ·ï¼‰

**åŸºç¡€è®¾æ–½**
- [ ] Dockerfile/Composeï¼ˆæœ¬åœ°ä¸€é”®èµ·ï¼‰
- [ ] K8s æ¸…å•ï¼ˆHPAã€PDBã€Secretã€ConfigMapï¼‰
- [ ] ç¯å¢ƒé…ç½®ï¼ˆdev/staging/prodï¼‰ä¸å¯†é’¥ç®¡ç†ï¼ˆKMS/ExternalSecretsï¼‰

**è´¨é‡ä¸å®‰å…¨**
- [ ] å•å…ƒ/é›†æˆæµ‹è¯•ï¼ˆåç«¯ä¸ç®—æ³•ï¼‰ã€å¥‘çº¦æµ‹è¯•ï¼ˆOpenAPIï¼‰
- [ ] é€Ÿç‡é™åˆ¶ä¸æ¶ˆè´¹ä¸Šé™ã€å®¡è®¡æ—¥å¿—
- [ ] æ•æ„Ÿè¯è§„åˆ™ä¸ä¸Šä¼ å®‰å…¨æ‰«æï¼ˆå¤§å°/ç±»å‹/å†…å®¹ï¼‰

---

# åä¸€ã€å…³é”®å‚æ•°å»ºè®®ï¼ˆåˆç‰ˆï¼‰
- æ£€ç´¢ TopKï¼š5ï¼ˆMMR=0.5ï¼Œå¯é€‰ï¼‰
- ç›¸ä¼¼åº¦é˜ˆå€¼ï¼š0.3ï¼ˆå¬å›è¿‡æ»¤ï¼‰
- Chunkï¼š600 tokensï¼Œoverlap 80ï¼ˆæŒ‰æ–‡æ¡£ç±»å‹åŠ¨æ€è°ƒï¼‰
- ç´¢å¼•ï¼šHNSWï¼ˆM=16, efC=200, efS=64ï¼‰ï¼Œè§„æ¨¡ä¸Šæ¥åè¯„ä¼° IVF_FLAT/HNSW_PQ
- LLMï¼štemperature 0.3ï¼Œmax_tokens 1024ï¼ˆMVPï¼‰

---

# åäºŒã€é£é™©ä¸å›é€€
- è±†åŒ… Embedding æœªå¼€é€š/ä¸ç¨³å®š â†’ å›é€€ bge-m3/bge-large-zh
- Milvus å†…å­˜å‹åŠ›è¿‡å¤§ â†’ å¯ç”¨åˆ†åŒº/åˆ†è¡¨ä¸ HNSW_PQï¼›é™ `efSearch`
- Ark API é™æµ â†’ åç«¯æ’é˜Ÿä¸æŒ‡æ•°é€€é¿ï¼›é¢„ä¼°é…é¢&å¹¶å‘
- é•¿æ–‡/è¡¨æ ¼è§£æè´¨é‡å·® â†’ é’ˆå¯¹ PDF/HTML å¼•å…¥ä¸“é¡¹è§£æå™¨

---

# åä¸‰ã€é‡Œç¨‹ç¢‘
- M1ï¼ˆç¬¬ 1 å‘¨ï¼‰ï¼šä»“åº“æ­å»ºã€SSE é€šè·¯ã€æœ€å°å¯¹è¯é€š
- M2ï¼ˆç¬¬ 2~3 å‘¨ï¼‰ï¼šIngest å…¨é“¾è·¯ã€Milvus å†™å…¥ä¸æ£€ç´¢ã€RAG é¦–ç­”
- M3ï¼ˆç¬¬ 4 å‘¨ï¼‰ï¼šç®¡ç†åå°ã€è§‚æµ‹ã€é…é¢/é™æµã€å®‰å…¨æœ€å°é›†
- M4ï¼ˆç¬¬ 5 å‘¨ï¼‰ï¼šè¯„æµ‹ä¸è°ƒå‚ã€ç¨³å®šæ€§ä¸æˆæœ¬ä¼˜åŒ–ã€è¯•ç‚¹ä¸Šçº¿
