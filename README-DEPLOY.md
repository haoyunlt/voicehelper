# ğŸš€ æœ¬åœ°éƒ¨ç½²æŒ‡å—

æ™ºèƒ½èŠå¤©æœºå™¨äººç³»ç»Ÿå®Œæ•´æœ¬åœ°éƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…å«æ‰€æœ‰ç¬¬ä¸‰æ–¹è½¯ä»¶çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- **CPU**: 4æ ¸å¿ƒä»¥ä¸Š
- **å†…å­˜**: 8GBä»¥ä¸Šï¼ˆæ¨è16GBï¼‰
- **å­˜å‚¨**: 20GBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥

### è½¯ä»¶è¦æ±‚
- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **æ“ä½œç³»ç»Ÿ**: macOS/Linux/Windows (WSL2)

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šæ™ºèƒ½éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd chatbot

# æ™ºèƒ½æ£€æµ‹å¹¶éƒ¨ç½²ï¼ˆè‡ªåŠ¨æ£€æµ‹ç¼ºå¤±çš„æœåŠ¡ï¼‰
./deploy.sh

# æˆ–æŒ‡å®šéƒ¨ç½²æ¨¡å¼
./deploy.sh --full      # å®Œæ•´éƒ¨ç½²æ‰€æœ‰æœåŠ¡
./deploy.sh --chatbot   # ä»…éƒ¨ç½²åº”ç”¨æœåŠ¡
./deploy.sh --infra     # ä»…éƒ¨ç½²åŸºç¡€è®¾æ–½
```

### æ–¹å¼äºŒï¼šå¿«é€Ÿç¯å¢ƒå¯åŠ¨

```bash
# å¼€å‘ç¯å¢ƒï¼ˆæœ€å°åŒ–ï¼‰
./deploy-helper.sh quick dev

# æµ‹è¯•ç¯å¢ƒï¼ˆå®Œæ•´ï¼‰
./deploy-helper.sh quick test

# æ¼”ç¤ºç¯å¢ƒï¼ˆå«ç›‘æ§ï¼‰
./deploy-helper.sh quick demo
```

> æ³¨ï¼šéƒ¨ç½²è„šæœ¬å®é™…ä½äº `deploy/scripts/` ç›®å½•ï¼Œæ ¹ç›®å½•çš„è„šæœ¬ä¸ºä¾¿æ·å…¥å£

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Makefile

```bash
# å®Œæ•´éƒ¨ç½²
make -f deploy/Makefile.local setup

# æˆ–è€…åˆ†æ­¥éª¤
make -f deploy/Makefile.local check-deps  # æ£€æŸ¥ä¾èµ–
make -f deploy/Makefile.local build       # æ„å»ºé•œåƒ
make -f deploy/Makefile.local up          # å¯åŠ¨æœåŠ¡
```

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### æœåŠ¡ç»„ä»¶

| æœåŠ¡ç±»å‹ | æœåŠ¡åç§° | ç«¯å£ | è¯´æ˜ |
|---------|---------|------|------|
| **åº”ç”¨æœåŠ¡** | Frontend | 3000 | Next.jså‰ç«¯ |
| | Gateway | 8080 | Goåç«¯ç½‘å…³ |
| | Algorithm | 8000 | Pythonç®—æ³•æœåŠ¡ |
| | Admin | 5001 | ç®¡ç†åå° |
| **æ•°æ®å­˜å‚¨** | PostgreSQL | 5432 | å…³ç³»æ•°æ®åº“ |
| | Redis | 6379 | ç¼“å­˜æ•°æ®åº“ |
| | Milvus | 19530 | å‘é‡æ•°æ®åº“ |
| | Neo4j | 7474/7687 | å›¾æ•°æ®åº“ |
| **ç›‘æ§æœåŠ¡** | Prometheus | 9090 | æŒ‡æ ‡æ”¶é›† |
| | Grafana | 3001 | ç›‘æ§é¢æ¿ |
| | cAdvisor | 8081 | å®¹å™¨ç›‘æ§ |
| **æ—¥å¿—æœåŠ¡** | Elasticsearch | 9200 | æ—¥å¿—å­˜å‚¨ |
| | Kibana | 5601 | æ—¥å¿—åˆ†æ |
| **æ¶ˆæ¯é˜Ÿåˆ—** | RabbitMQ | 5672/15672 | æ¶ˆæ¯ä¸­é—´ä»¶ |
| **æ–‡ä»¶å­˜å‚¨** | MinIO | 9000/9001 | å¯¹è±¡å­˜å‚¨ |

### ç½‘ç»œæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker Network                       â”‚
â”‚                 (172.20.0.0/16)                        â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Frontend   â”‚  â”‚   Gateway   â”‚  â”‚  Algorithm  â”‚     â”‚
â”‚  â”‚   :3000     â”‚  â”‚    :8080    â”‚  â”‚    :8000    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                 â”‚                 â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Data Layer                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚
â”‚  â”‚  â”‚PostgreSQLâ”‚ â”‚  Redis  â”‚ â”‚ Milvus  â”‚ â”‚ Neo4j   â”‚â”‚    â”‚
â”‚  â”‚  â”‚  :5432   â”‚ â”‚  :6379  â”‚ â”‚ :19530  â”‚ â”‚ :7474   â”‚â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Monitoring Layer                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚
â”‚  â”‚  â”‚Prometheusâ”‚ â”‚ Grafana â”‚ â”‚Elasticsearchâ”‚ â”‚Kibanaâ”‚â”‚    â”‚
â”‚  â”‚  â”‚  :9090   â”‚ â”‚  :3001  â”‚ â”‚  :9200  â”‚ â”‚ :5601   â”‚â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

å¤åˆ¶å¹¶ç¼–è¾‘ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š

```bash
cp env.local .env
```

**é‡è¦é…ç½®é¡¹**ï¼š

```bash
# LLM API Keys (å¿…é¡»é…ç½®)
OPENAI_API_KEY=your-openai-api-key-here
ARK_API_KEY=your-ark-api-key-here

# å¾®ä¿¡å°ç¨‹åº (å¯é€‰)
WECHAT_APP_ID=your-wechat-app-id
WECHAT_APP_SECRET=your-wechat-app-secret

# JWTå¯†é’¥ (ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹)
JWT_SECRET=your-jwt-secret-key-for-development
```

### æ•°æ®åº“é…ç½®

ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æ•°æ®åº“ï¼š

- **PostgreSQL**: `chatbot` æ•°æ®åº“ï¼Œç”¨æˆ· `chatbot/chatbot123`
- **Redis**: å¯†ç  `redis123`
- **Neo4j**: ç”¨æˆ· `neo4j/neo4j123`

## ğŸš€ éƒ¨ç½²æ¨¡å¼è¯´æ˜

### æ™ºèƒ½éƒ¨ç½²æ¨¡å¼

`deploy.sh` æ”¯æŒå¤šç§éƒ¨ç½²æ¨¡å¼ï¼š

| æ¨¡å¼ | å‘½ä»¤ | è¯´æ˜ |
|------|------|------|
| **æ™ºèƒ½æ¨¡å¼** | `./deploy.sh` | è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒï¼Œä»…éƒ¨ç½²ç¼ºå¤±çš„æœåŠ¡ |
| **å®Œæ•´éƒ¨ç½²** | `./deploy.sh --full` | éƒ¨ç½²æ‰€æœ‰åŸºç¡€è®¾æ–½å’Œåº”ç”¨æœåŠ¡ |
| **åº”ç”¨éƒ¨ç½²** | `./deploy.sh --chatbot` | ä»…éƒ¨ç½²èŠå¤©æœºå™¨äººåº”ç”¨ï¼ˆè‡ªåŠ¨æ£€æŸ¥ä¾èµ–ï¼‰ |
| **åŸºç¡€è®¾æ–½** | `./deploy.sh --infra` | ä»…éƒ¨ç½²åŸºç¡€è®¾æ–½æœåŠ¡ |
| **å•æœåŠ¡** | `./deploy.sh --service redis` | éƒ¨ç½²ç‰¹å®šæœåŠ¡ |

### éƒ¨ç½²é€‰é¡¹

```bash
# å¼ºåˆ¶é‡æ–°éƒ¨ç½²ï¼ˆå³ä½¿æœåŠ¡å·²å­˜åœ¨ï¼‰
./deploy.sh --full --force

# è·³è¿‡é•œåƒæ„å»º
./deploy.sh --chatbot --skip-build

# æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
./deploy.sh --full --verbose

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy.sh --status

# æ¸…ç†æ‰€æœ‰æœåŠ¡
./deploy.sh --clean
```

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### åŸºç¡€æ“ä½œ

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
make -f deploy/Makefile.local status

# æŸ¥çœ‹æ—¥å¿—
make -f deploy/Makefile.local logs

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
make -f deploy/Makefile.local logs-f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
make -f deploy/Makefile.local logs-postgres
make -f deploy/Makefile.local logs-gateway
```

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
make -f deploy/Makefile.local up

# åœæ­¢æ‰€æœ‰æœåŠ¡
make -f deploy/Makefile.local down

# é‡å¯æœåŠ¡
make -f deploy/Makefile.local restart

# ä»…å¯åŠ¨åŸºç¡€è®¾æ–½ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
make -f deploy/Makefile.local dev
```

### æ•°æ®åº“ç®¡ç†

```bash
# åˆå§‹åŒ–æ•°æ®åº“
make -f deploy/Makefile.local db-init

# é‡ç½®æ•°æ®åº“
make -f deploy/Makefile.local db-reset

# å¤‡ä»½æ•°æ®åº“
make -f deploy/Makefile.local db-backup
```

### ç›‘æ§å’Œè°ƒè¯•

```bash
# å¥åº·æ£€æŸ¥
make -f deploy/Makefile.local health

# æŸ¥çœ‹èµ„æºä½¿ç”¨
make -f deploy/Makefile.local stats

# è¿›å…¥å®¹å™¨
make -f deploy/Makefile.local shell-postgres
make -f deploy/Makefile.local shell-redis
```

## ğŸŒ è®¿é—®åœ°å€

### åº”ç”¨æœåŠ¡
- **å‰ç«¯ç•Œé¢**: http://localhost:3000
- **APIç½‘å…³**: http://localhost:8080
- **ç®—æ³•æœåŠ¡**: http://localhost:8000/docs (Swagger)
- **ç®¡ç†åå°**: http://localhost:5001

### ç›‘æ§é¢æ¿
- **Grafana**: http://localhost:3001 (`admin/admin123`)
- **Prometheus**: http://localhost:9090
- **Kibana**: http://localhost:5601

### æ•°æ®åº“ç®¡ç†
- **Neo4j Browser**: http://localhost:7474 (`neo4j/neo4j123`)
- **RabbitMQ**: http://localhost:15672 (`rabbitmq/rabbitmq123`)
- **MinIO Console**: http://localhost:9001 (`minioadmin/minioadmin`)

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### éƒ¨ç½²åŠ©æ‰‹å·¥å…·

`deploy-helper.sh` æä¾›äº¤äº’å¼ç®¡ç†ç•Œé¢ï¼š

```bash
# æ‰“å¼€äº¤äº’å¼èœå•
./deploy-helper.sh

# æˆ–ç›´æ¥æ‰§è¡ŒåŠŸèƒ½
./deploy-helper.sh health      # å¥åº·æ£€æŸ¥æŠ¥å‘Š
./deploy-helper.sh backup      # å¤‡ä»½æ•°æ®
./deploy-helper.sh diagnose    # æ•…éšœè¯Šæ–­
./deploy-helper.sh monitor     # æ‰“å¼€ç›‘æ§é¢æ¿
```

### æ•°æ®å¤‡ä»½ä¸æ¢å¤

```bash
# è‡ªåŠ¨å¤‡ä»½æ‰€æœ‰æ•°æ®
./deploy-helper.sh backup

# æ¢å¤æ•°æ®
./deploy-helper.sh restore backups/20240321_143022.tar.gz
```

### ç¯å¢ƒæ£€æµ‹åŠŸèƒ½

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ï¼š
- âœ… å·²éƒ¨ç½²çš„æœåŠ¡ï¼ˆè·³è¿‡ï¼‰
- âš ï¸ æœªè¿è¡Œçš„æœåŠ¡ï¼ˆé‡å¯ï¼‰
- âŒ ç¼ºå¤±çš„æœåŠ¡ï¼ˆè‡ªåŠ¨éƒ¨ç½²ï¼‰
- ğŸ” ç«¯å£å†²çªï¼ˆæç¤ºè§£å†³ï¼‰

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£å†²çª
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5432  # PostgreSQL
lsof -i :6379  # Redis
lsof -i :19530 # Milvus

# è§£å†³æ–¹æ¡ˆï¼šåœæ­¢å ç”¨ç«¯å£çš„æœåŠ¡æˆ–ä¿®æ”¹é…ç½®
```

#### 2. å†…å­˜ä¸è¶³
```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
docker stats

# è§£å†³æ–¹æ¡ˆï¼š
# - å¢åŠ ç³»ç»Ÿå†…å­˜
# - è°ƒæ•´æœåŠ¡é…ç½®
# - åˆ†æ‰¹å¯åŠ¨æœåŠ¡
```

#### 3. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹å…·ä½“é”™è¯¯
docker-compose -f docker-compose.local.yml logs [service-name]

# å¸¸è§è§£å†³æ–¹æ¡ˆï¼š
# - æ£€æŸ¥é…ç½®æ–‡ä»¶
# - ç¡®è®¤ä¾èµ–æœåŠ¡å·²å¯åŠ¨
# - æ£€æŸ¥ç£ç›˜ç©ºé—´
```

#### 4. ç½‘ç»œè¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥ç½‘ç»œ
docker network ls
docker network inspect chatbot_chatbot-network

# é‡å»ºç½‘ç»œ
make -f Makefile.local clean
make -f Makefile.local up
```

### æ—¥å¿—ä½ç½®

```bash
# å®¹å™¨æ—¥å¿—
docker-compose -f deploy/docker-compose.local.yml logs [service]

# åº”ç”¨æ—¥å¿—ï¼ˆå¦‚æœæŒ‚è½½ï¼‰
./deploy/local/logs/

# æ•°æ®åº“æ—¥å¿—
docker exec chatbot-postgres tail -f /var/log/postgresql/postgresql.log
```

## ğŸ§¹ æ¸…ç†å’Œç»´æŠ¤

### æ—¥å¸¸ç»´æŠ¤

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -f

# æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune -f

# æ›´æ–°åŸºç¡€é•œåƒ
make -f Makefile.local update
```

### å®Œå…¨æ¸…ç†

```bash
# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨
make -f deploy/Makefile.local clean

# åˆ é™¤æ‰€æœ‰æ•°æ®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
make -f deploy/Makefile.local clean-all
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### èµ„æºé…ç½®å»ºè®®

```yaml
# docker-compose.local.yml ä¸­çš„èµ„æºé™åˆ¶ç¤ºä¾‹
services:
  postgres:
    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 1G
```

### ç›‘æ§æŒ‡æ ‡

å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š
- **CPUä½¿ç”¨ç‡**: < 80%
- **å†…å­˜ä½¿ç”¨ç‡**: < 85%
- **ç£ç›˜ä½¿ç”¨ç‡**: < 90%
- **ç½‘ç»œå»¶è¿Ÿ**: < 100ms

## ğŸ” å®‰å…¨é…ç½®

### ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
2. **é…ç½®é˜²ç«å¢™è§„åˆ™**
3. **å¯ç”¨SSL/TLS**
4. **å®šæœŸå¤‡ä»½æ•°æ®**
5. **ç›‘æ§å®‰å…¨æ—¥å¿—**

### ç½‘ç»œå®‰å…¨

```bash
# ä»…æš´éœ²å¿…è¦ç«¯å£
# åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç§»é™¤ä¸å¿…è¦çš„ç«¯å£æ˜ å°„
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†
2. æ£€æŸ¥ GitHub Issues
3. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼š`docs/PROJECT_MASTER_DOC.md`

---

**ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰
